<form hideEdit="true" theme="dark">
  <init>
    <set token="pivot_tk">timechart</set>
  </init>
  <label>Natural Language Search</label>
  <search id="base">
    <query>$form.splquery$</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <fieldset submitButton="false" autoRun="true">
    <html>
      <a target="_self" href="nl">Reset the form before start building a new query (click here to reset)</a>
      <br/>
    </html>
    <input type="dropdown" token="help" searchWhenChanged="true">
      <label>Help</label>
      <choice value="on">Show</choice>
      <change>
        <condition value="on">
          <set token="help_tk">on</set>
        </condition>
        <condition>
          <unset token="help_tk"></unset>
        </condition>
      </change>
    </input>
    <input type="dropdown" token="visualisation" depends="$form.event$,$form.splquery$" searchWhenChanged="true">
      <label>Visualisation</label>
      <choice value="timechart">Time Chart</choice>
      <choice value="pivot">Pivot</choice>
      <change>
        <condition value="timechart">
          <set token="timechart_tk">timechart</set>
          <unset token="pivot_tk"></unset>
        </condition>
        <condition value="pivot">
          <unset token="timechart_tk"></unset>
          <set token="pivot_tk">pivot</set>
        </condition>
      </change>
      <default>timechart</default>
      <initialValue>timechart</initialValue>
    </input>
    <input type="time" token="time" depends="$form.splquery$" searchWhenChanged="true">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <table>
        <title>Matching Events for $form.full_query$</title>
        <search base="base">
          <query>| fields *.name, count_* | fields - _raw</query>
        </search>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
    <panel depends="$form.event$,$timechart_tk$" rejects="$pivot_tk$,$stats_tk$">
      <title>Visualisation</title>
      <chart>
        <search base="base">
          <query>| timechart count by $form.by$</query>
        </search>
        <option name="charting.chart">line</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel depends="$form.event$,$pivot_tk$" rejects="$timechart_tk$,$stats_tk$">
      <title>Visualisation</title>
      <chart>
        <search>
          <query>| stats count by $form.by$</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row depends="$query_tk$,$help_tk$" rejects="$and_tk$">
    <panel>
      <html>
        <p>
          <strong>Click on the statement that is closer to your desired result</strong>
          <br/>
          <strong>*</strong>To execute the query generated by the current selection, click on the query checkbox and then update time period and/or visualisation
        </p>
    </html>
    </panel>
  </row>
</form>